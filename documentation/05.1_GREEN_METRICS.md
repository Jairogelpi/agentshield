# 游 5.1 Observabilidad: M칠tricas Verdes (`analytics.py`)

> **Objetivo**: Ayudar a las empresas a cumplir con RSC (Responsabilidad Social Corporativa) reportando el impacto de carbono de su IA.
> **Archivo**: `app/routers/analytics.py`

---

## 1. `get_carbon_dashboard`
```python
@router.get("/v1/analytics/sustainability")
```
Este endpoint genera el "Certificado de Computaci칩n Verde".

### C치lculo de CO2
No usamos n칰meros m치gicos. Usamos datos reales aggregrados por la base de datos:
1.  **RPC `get_total_carbon`**: Suma la columna `carbon_g` de todos los recibos del tenant.
    *   *Nota*: Cada petici칩n calcula su impacto individualmente bas치ndose en el modelo (GPT-4 consume m치s energ칤a que Haiku) y el tiempo de ejecuci칩n.

### Equivalencia en 츼rboles
Para que el dato sea entendible por humanos (CEOs):
```python
trees_equivalent = total_co2 / 57.0
```
*   **Ciencia**: Un 치rbol maduro absorbe ~21kg de CO2 al a침o, lo que equivale a unos **57 gramos al d칤a**.
*   Si tu IA emite 114g de CO2 hoy, necesitas 2 치rboles trabajando hoy para compensarlo.

### Calificaci칩n Energ칠tica (Energy Mix)
```python
"energy_mix_rating": "A+" if current_region == "eu" else "B"
```
*   Si el servidor corre en **Europa** (nuestros servidores de Finlandia/Alemania), la energ칤a suele ser m치s verde (renovables).
*   Si corre en **US** (Virginia), suele ser carb칩n/gas ("B").
