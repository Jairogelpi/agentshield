# üõ°Ô∏è 5.3 Dashboard: Pol√≠ticas y Seguridad (`dashboard.py`)

> **Objetivo**: Gesti√≥n de reglas de juego. Qui√©n puede gastar qu√©, y c√≥mo reaccionar ante emergencias.
> **Secci√≥n**: Endpoints de Configuraci√≥n

---

## 1. `update_policy` (Hot Reload)
```python
@router.put("/policy")
```
*   Permite cambiar reglas (l√≠mites mensuales, whitelist de modelos) en caliente.
*   **Mecanismo**:
    1.  Actualiza PostgreSQL (`policies` table).
    2.  `await redis_client.delete(f"policy:active:{tenant}")`.
*   Esto fuerza a todos los Proxy Workers a recargar la nueva pol√≠tica en su pr√≥xima petici√≥n (Cache Invalidation), aplicando el cambio globalmente en milisegundos.

## 2. `kill_switch` (Bot√≥n Rojo)
```python
@router.post("/emergency/stop")
```
*   **Funci√≥n**: Detener TODO el tr√°fico de un tenant inmediatamente.
*   **Acci√≥n**:
    1.  Escribe una regla de p√°nico en DB (L√≠mites = 0).
    2.  Coloca una bandera especial en Redis: `kill_switch:{tenant}`.
*   El Proxy checkea esta bandera antes de procesar nada.

## 3. `rotate_api_key` (Zero Downtime)
```python
@router.post("/keys/rotate")
```
*   **Problema**: Rotar una API Key suele romper las apps en producci√≥n hasta que actualizas la variable de entorno.
*   **Soluci√≥n Dual**:
    1.  Genera una llave nueva (`Primary`).
    2.  Mueve la llave vieja a `Secondary`.
    3.  Establece `expires_at` para la secundaria (24 horas).
*   Esto da al equipo de DevOps 24 horas para actualizar sus sistemas sin que el servicio se pare ni un segundo.

## 4. `update_webhook`
```python
@router.put("/webhook")
```
*   Configura d√≥nde enviar alertas as√≠ncronas (ej: "Presupuesto Agotado", "Ataque Detectado").
