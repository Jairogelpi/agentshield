# 游늯 5.4 Dashboard: Reportes y Compliance (`dashboard.py`)

> **Objetivo**: Sacar datos del sistema de forma masiva (Bulk Export) sin tumbar el servidor.
> **Secci칩n**: Endpoints de Streaming y Auditor칤a

---

## 1. `download_dispute_pack` (Streaming CSV)
```python
@router.get("/reports/audit", response_class=StreamingResponse)
```
*   **Problema**: Un cliente Enterprise tiene 100,000 recibos. Generar un CSV en memoria consume 500MB de RAM. Con 4 usuarios, el servidor crashea.
*   **Soluci칩n (Python Generators)**:
    *   Usamos `yield` para generar el CSV l칤nea a l칤nea (o bloque a bloque).
    *   FastAPI transmite (streams) estos bytes al navegador a medida que se generan.
    *   **Consumo de RAM**: Constante (~10MB), sin importar si el CSV pesa 1GB.

## 2. `get_residency_report` (GDPR)
```python
@router.get("/compliance/residency-report")
```
*   **Auditor칤a de Soberan칤a**: Verifica d칩nde se proces칩 realmente cada petici칩n.
*   Retorna porcentajes: `processed_in_eu` vs `processed_in_us`.
*   Si un cliente UE tiene tr치fico procesado en US, marca el estado como `CRITICAL_ERROR`.

## 3. `get_full_trace_story`
```python
@router.get("/traces/{trace_id}/full")
```
*   Busca todas las transacciones relacionadas con un `Trace ID` distribuido.
*   Permite reconstruir la historia de una "Cadena de Pensamiento" (Chain of Thought) de un Agente, viendo cu치nto cost칩 cada paso individualmente.
