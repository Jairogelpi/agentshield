version: '3.8'

services:
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: agentshield_chat_client
    restart: always
    ports:
      - "3000:8080"
    environment:
      # --- 1. CONEXIÓN AL CEREBRO AGENTSHIELD ---
      # Apunta a tu backend desplegado en Render
      - OPENAI_API_BASE_URL=https://tu-agentshield-backend.onrender.com/v1
      - OPENAI_API_KEY=sk-proj-agentshield-master-key  # Placeholder (la seguridad es por JWT/Header)

      # --- 2. IDENTIDAD Y SEGURIDAD (SSO) ---
      # WEBUI_AUTH=true obliga a OpenWebUI a gestionar usuarios
      # y pasar el JWT en las cabeceras hacia tu backend.
      - WEBUI_AUTH=true
      - SHOW_ADMIN_DETAILS=false      # Ocultar admin panel a usuarios finales
      - ENABLE_SIGNUP=false           # Solo Admin crea usuarios (o SSO externo)
      
      # --- 3. EXPERIENCIA DE USUARIO (Marca Blanca) ---
      - ENABLE_MODEL_SWITCHING=true   # Permitir elegir "Smart" vs "Fast"
      - DEFAULT_MODELS=agentshield-fast,agentshield-smart
      
      # --- 4. RAG AUDITADO (Neural Hive) ---
      # Forzamos a que el RAG (subida de PDFs) pase por tu router de Embeddings
      # para que puedas auditar y cobrar por la vectorización.
      - ENABLE_RAG_WEB_SEARCH=true
      - RAG_EMBEDDING_ENGINE=openai
      - RAG_OPENAI_API_BASE_URL=https://tu-agentshield-backend.onrender.com/v1
      - RAG_OPENAI_API_KEY=sk-proj-agentshield-master-key

    volumes:
      - open-webui-data:/app/backend/data

volumes:
  open-webui-data:
