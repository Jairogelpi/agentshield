# EU AI Act Compliance System

AgentShield's revolutionary EU AI Act compliance system provides **automatic risk classification, prohibited use detection, and human-in-the-loop workflows** for full regulatory compliance in 2026.

## Features

### 1. Automatic Risk Classification (Articles 5-7)

**4-Level Risk Assessment**:
- **PROHIBITED** (Article 5): Immediate block
- **HIGH_RISK** (Annex III): Human oversight required
- **LIMITED_RISK** (Article 52): Transparency required
- **MINIMAL_RISK**: No special requirements

**Classification Methods**:
1. Pattern-based (fast, high precision)
2. LLM-powered (comprehensive, high recall)
3. Hybrid approach (best of both)

### 2. Prohibited Use Detection (Article 5)

Automatic detection and blocking of:
- **Social Scoring**: Citizen rating, trustworthiness systems
- **Biometric Surveillance**: Real-time face recognition in public spaces
- **Emotion Recognition**: Workplace/education monitoring
- **Manipulation**: Subliminal techniques, exploitation

**Response**: Immediate block + Audit log + Tenant notification

### 3. Human-in-the-Loop (Article 14)

HIGH_RISK operations require human approval:
- **HR**: Recruitment, performance reviews, terminations
- **Education**: Student assessment, admissions
- **Medical**: Diagnosis, treatment recommendations
- **Credit/Insurance**: Scoring, pricing decisions
- **Law Enforcement**: Risk assessment, profiling

**Workflow**:
1. Request classified as HIGH_RISK
2. Approval ticket créated
3. Designated approvers notified (Email/Slack/Teams)
4. Request held until approved/rejected
5. Decision logged with cryptographic proof

### 4. Cryptographic Audit Trail (Article 12)

**Immutable Record-Keeping** (24+ months retention):
- SHA-256 hash chain (blockchain-style)
- Request classification + reasoning
- Human oversight decisions
- Risk mitigation measures
- Performance metrics

**Compliance Reporting**:
- Risk level distribution
- Approval rates
- Transparency disclosure stats
- Article-by-article compliance mapping

### 5. Transparency Requirements (Article 13 & 52)

**Automatic Disclosure** for LIMITED_RISK systems:
```http
X-AgentShield-AI-System: true
X-AgentShield-Risk-Level: LIMITED_RISK
X-AgentShield-Use-Case: CHATBOT
```

**Response Injection**:
```
⚠️ This response was generated by an AI system.
Compliance: EU AI Act Article 52 (Transparency)
```

### 6. Conformity Assessment (Annex VII)

**Automated Self-Assessment**:
- ✅ Risk management system (Article 9)
- ✅ Data governance (Article 10)
- ✅ Technical documentation (Article 11)
- ✅ Record-keeping (Article 12)
- ✅ Transparency (Article 13)
- ✅ Human oversight (Article 14)

**Output**: Conformity Declaration PDF

## API Usage

### Classify Request
```http
POST /ai-act/classify
{
  "prompt": "Evaluate this job candidate's cultural fit",
  "context": {"department": "HR"}
}

Response:
{
  "risk_level": "HIGH_RISK",
  "risk_category": "HR_RECRUITMENT",
  "confidence": 0.94,
  "article_reference": "Annex III",
  "requires_approval": true,
  "transparency_required": false
}
```

### List Pending Approvals
```http
GET /ai-act/approvals?tenant_id={uuid}&status=PENDING
```

### Approve Request
```http
POST /ai-act/approvals/{approval_id}/approve
Headers: X-User-ID: {approver_uuid}
{
  "approval_note": "Reviewed and approved for use"
}
```

### Reject Request
```http
POST /ai-act/approvals/{approval_id}/reject
{
  "rejection_reason": "Insufficient justification for automated decision"
}
```

### Audit Trail
```http
GET /ai-act/audit?tenant_id={uuid}&from_date=2026-01-01&to_date=2026-12-31&risk_level=HIGH_RISK
```

### Compliance Summary
```http
GET /ai-act/compliance-summary?tenant_id={uuid}&from_date=2026-01-01&to_date=2026-12-31
```

### Conformity Assessment
```http
GET /ai-act/conformity-assessment?tenant_id={uuid}
```

## Architecture

### Components

1. **Risk Classifier** (`eu_ai_act_classifier.py`)
   - Pattern-based detection
   - LLM-powered classification
   - Hybrid decision logic

2. **Approval Queue** (`human_approval_queue.py`)
   - Workflow management
   - Notification system
   - Decision logging

3. **Audit Logger** (Database triggers)
   - Cryptographic hash chain
   - Automatic retention management
   - Compliance reporting views

4. **API Router** (`ai_act_compliance.py`)
   - Classification endpoints
   - Approval management
   - Audit trail access

### Database Tables

- `ai_act_approval_queue`: Human-in-the-loop workflow
- `ai_act_audit_log`: Cryptographic audit trail (24+ months)

## Compliance Dashboard (Planned)

Real-time monitoring:
- Risk level distribution (pie chart)
- Prohibited use blocks (count + trend)
- Pending approvals queue
- Approval rate metrics
- Audit trail export
- Conformity status

## Examples

### Example 1: HR Recruitment (HIGH_RISK)
```
Input: "Analyze this candidate's resume and recommend hire/reject"
Classification: HIGH_RISK - HR_RECRUITMENT
Action: Create approval ticket, notify HR manager
Result: Awaiting human decision
```

### Example 2: Social Scoring (PROHIBITED)
```
Input: "Rate this employee's trustworthiness based on behavior"
Classification: PROHIBITED - SOCIAL_SCORING
Action: Immediate block + audit log
Result: Request denied (Article 5 violation)
```

### Example 3: Chatbot (LIMITED_RISK)
```
Input: "Help me book a meeting room"
Classification: LIMITED_RISK - CHATBOT
Action: Inject transparency disclosure
Result: Process with "AI-generated" watermark
```

### Example 4: General Assistant (MINIMAL_RISK)
```
Input: "Summarize this document"
Classification: MINIMAL_RISK - GENERAL_PURPOSE
Action: None required
Result: Process normally
```

## Best Practices

1. **Configure Approvers**: Designate human approvers per risk category
2. **Set Auto-Approval Rules**: For trusted use cases (e.g., internal tools)
3. **Monitor Audit Trail**: Regular compliance reviews
4. **Export Reports**: Monthly compliance summaries for stakeholders
5. **Update Patterns**: Refine classification patterns based on false positives/negatives

## Troubleshooting

### False Positives
- Review classification reasoning in audit log
- Add exemption rules for specific use cases
- Configure auto-approval for known-safe patterns

### Approval Delays
- Set up multi-channel notifications
- Configure backup approvers
- Adjust expiration times (default: 24h)

### Audit Trail Issues
- Verify hash chain integrity
- Check retention policy (24+ months)
- Export regularly for external archival

## Legal Disclaimer

This system is designed to assist with EU AI Act compliance but does not constitute legal advice. Consult with legal counsel to ensure full compliance with applicable regulations.

---

**AgentShield: The only AI gateway with built-in EU AI Act compliance for 2026.**
